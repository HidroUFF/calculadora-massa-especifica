<div align='center'>
  <img align="center" alt="Logo" height="100" width="100" src="https://raw.githubusercontent.com/HidroUFF/calculadora-massa-especifica/main/assets/icon.ico">
</div>  
<p align="center">
  <strong>HidroUFF Density Calculator</strong>
  <br>
  <strong>Versão 1.3.0</strong>
</p> 
<div align="center"> 
  
  <a href="https://doi.org/10.5281/zenodo.5719756"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5719756.svg" alt="DOI"></a>
  
</div>

<h1 align="center">Developer's Guide</h1>
<p align="center">
  This application's main feature is the calculation of the density of gas mixtures, through the resolution of Peng Robinson's cubic equation of state. Currently, there are 20 substances already registered in the tool and support for adding new substances by the user. In addition, the tool has an interface in English, Portuguese and Spanish.
</p> 

<p align="center">
 <a href="https://hidrouff.github.io/calculadora-massa-especifica/">Getting started</a> •
 <a href="#technologies">Technology</a> •
 <a href="#dirs">Directory and file structure</a> •
 <a href="#author">Development</a> •
 <a href="#quoting">Quoting</a>
</p>

<h2 id="technologies" align="justify">Technology</h2>
<div align="center">
  <img align="center" alt="Python" height="50" width="50" src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg">
 </div>

* Python - version 3
* Python libraries:
  * PyQt5
  * Sympy
  * Matplotlib

<h2 id="dirs" align="justify">Directory and file structure</h2>

* <a href="#bin">/bin</a>
* <a href="#data">/data</a>
* <a href="#utility">/utility</a>
* <a href="#src">/src</a>

<h2 id="bin" align="justify">/bin</h2>
<p align="justify">
 The /bin directory stores the application's executable files.
</p> 

<h2 id="data" align="justify">/data</h2>
<p align="justify">
   The /data directory stores CSV files that contain the properties of the substances registered in the application, such as molar mass (g/mol), critical pressure (KPa), critical temperature (K) and acentric factor. Furthermore, it contains the values of the kij parameters that represent the interaction between each pair of substances.
</p>

<h2 id="utility" align="justify">/utility</h2>
<p align="justify">
  The /utility directory contains the utility responsible for adding new substances to the application by transforming the files contained in /data into a single file called "constant.py" in /src for use by the application. To add new substances just follow the instructions in <a href="https://hidrouff.github.io/calculadora-massa-especifica/">Getting started</a>.
</p>

<h2 id="src" align="justify">/src</h2>
<p align="justify">
  Directory that stores the application's source code, composed of six modules:
</p>

<h3 align="justify">main.py</h3>
<p align="justify">
  Used to launch the application.
</p>

<h3 align="justify">constant.py</h3>
<p align="justify">
  They contain constants that store the values of the properties of substances that can be used by the program. This file is generated by the csvToPy utility from the files in /data. At each generation the file is overwritten.
</p>

<h3 align="justify">imagesAndFonts.py</h3>
<p align="justify">
  Stores the images and fonts used by the application in binary format. It is recommended not to make any changes to this file in order not to render it unusable.
</p>

<h3 align="justify">gui.py</h3>
<p align="justify">
  Module responsible for building the user interface through the PyQt5 library.
</p>

<h4 align="justify">Class Ui_MainWindoow and your methods</h4>

* **add(self) -> None**
    
    Dynamically add frames for new substances.
 
    **:param self:** <br>
    **:rtype:** None

* **ajuda(self) -> None**
    
    Displays help screen.

    **:param self:** <br>
    **:rtype:** None
    
* **calcular(self) -> None**
    
    Reads data from the interface, gets the result for calculation when there 
    is a single pressure and displays it on the screen.

    **:param self:** <br>
    **:rtype:** None
    
* **delete(self, botao) -> None**
    
    Delete frames of dynamically added substances.
    
    **:param self:** <br>
    **:rtype:** None
    
* **fecharTela(self) -> None**

    Closes the screen over the software or help screen.

    **:param self:** <br>
    **:rtype:** None
    
* **filtrar(self) -> list**

    Gets index of items already selected in the existing comboBox.

    **:param self:** <br>
    **:return aux:** vector with indices of items already selected in the existing comboBox. <br>
    **:rtype:** list

* **gerarGraficoAPartirDeArq(self) -> None**

    Opens file dialog for user to choose a .csv file separated by ";" with two columns: the first with pressure values and the second with specific mass values and generates the isotherm graph.

    **:param self:** <br>
    **:rtype:** None
    
* **gerarGraficoDaIsoterma(self) -> None**
    
    It reads data from the interface, gets the result for the calculation when there is a range of pressure values and generates the graph of the isotherm.

    **:param self:** <br>
    **:rtype:** None
    
* **getBotaoClicado(self, botao) -> int** 
    
    Find which of the dynamic buttons was clicked.

    **:param self:** <br>
    **:return i:** clicked dynamic button index
    **:rtype:** int

* **getIndiceAtual(self) -> int**
    
    Gets index of the next item not yet selected in the existing comboBox.

    **:param self:** <br>
    **:return indice:** index of the next item not yet selected in the existing comboBox.
    **:rtype:** int

* **getLanguage(self) -> str**
    
    Discover system default language to set appropriate language according to languages available in application.

    **:param self:** <br>
    **:rtype:** None

* **input(self) -> list**

    Reads the data entered in the interface and checks if there is any problem with the data.

    **:param self:** <br>
    **:return inputs:** inputs = [composicao, temperatura, pressao] <br>
    **:rtype:** list

* **limparCampos(self) -> None**
  
    Clear the filled fields.

    **:param self:** <br>
    **:rtype:** None

* **mostrarMsgmDeErro(self, mensagem) -> None**
    
    Shows an error message on the screen.

    **:param self:** <br>
    **:param mensagem:** string mostrada na tela <br>
    **:rtype:** None

* **onClicked(self) -> bool**

    Checks if the radio button was clicked and displays the corresponding frame.

    **:param self:** <br>
    **:rtype:** bool

* **retranslateUi(self, MainWindow) -> None**
    
    Performs the translation of the elements present in the user interface to the selected language.

    **:param self:** <br>
    **:rtype:** None

* **salvarResultado(self) -> None**
  
    It reads data from the interface, gets the result for the calculation when there is a range of pressure values and saves the result in a CSV file.
 
    **:param self:** <br>
    **:rtype:** None
    
* **setarIdioma(self, MainWindow) -> None**
    
    Applies language change event when corresponding button is clicked according to chosen language.
 
    **:param self:** <br>
    **:rtype:** None

* **setupUi(self, MainWindow) -> None**
    * Responsible for building all user interface elements on screen.

    **:param self:** <br>
    **:rtype:** None
    
* **sobre(self) -> None**
    
    Displays the screen about the software.

    **:param self:** <br>
    **:rtype:** None

<h3 align="justify">verificacaoDeEntrada.py</h3>
<p align="justify">
  Contains the methods used to perform file and data entry verification.
</p>

<h4 align="justify">Functions</h4>

* **verificar_arquivo(dados, t) -> bool**

    Checks if input .csv file has content in correct format.

    **:param dados:** vector containing all lines of the read file. <br>
    **:return:** True, if the file is whole; false otherwise. <br>
    **:rtype:** bool

* **verificar_campos_em_branco(vetor, pressaoUnica) -> bool**

    Checks for blank fields in input data.
    
    **:param vetor:** list with all input data in format
                   vector = [data regarding the composition of the mixture, temperature, pressure]. <br>
    **:param presssaoUnica:** boolean indicating if there is a single pressure value or an interval. <br>
    **:return:** True, if there are blank fields; False otherwise. <br>
    **:rtype:** bool

* **verificar_substancias_repetidas(vetor) -> bool**

    Checks whether repeated substances were selected from the mixture composition input data.

    **:param vetor:** matrix with the dynamic elements of the interface referring to the composition of the mixture 
                each line corresponds to a vector = [frame, comboBox, lineEdit, pushButton]. <br> 
    **:return:** True, if there are repeated substances; false otherwise. <br>
    **:rtype:** bool

<h3 align="justify">calculadora.py</h3>
<p align="justify">
  Contém os métodos utilizados para realização dos cálculos e processamento dos dados. Nos cálculos utiliza as propriedades das substâncias armazenadas em constant.py.
</p>

<h4 align="justify">Functions</h4>

* **Ai(vsubs2, vki, vt, r) -> list**

    Calculates the ai term of each component.
    
    **:param vsubs2:** list with substances  <br>
    **:param vki:** ki term of the elements <br>
    **:param vt:** temperature in kelvin <br>
    **:rtype:** list

* **Subs2(velementos, vsubs) -> list**

  Creates a new list of substances from 'subs' so that it is in the same order as the 'elements' list, to facilitate the calculation of aij.

  **:param velementos:** <br>
  **:param vsubs:** <br>
  **:rtype:** list

* **calcular_pressao_intervalo(composicao, temperatura, pressao_inicial, pressao_final, passo) -> list**

    Realiza o cálculo da massa específica quando é fornecido Performs the calculation 
    of the specific mass when a range of pressure values is provided through the 
    data received from the user in the interface mediated by the gui module.

    **:param composicao:**  <br>
    **:param temperatura:** <br>
    **:param pressao_inicial:** <br>
    **:param pressao_final:** <br>
    **:param passo:** <br>
    **:return pressoes, mEspIsoterma:** list of pressures and densities <br>
    **:rtype:** list
    
* **calcular_pressao_unica(composicao, temperatura, pressao) -> float**

    It performs the calculation of the specific mass when a pressure value 
    is provided through the data received from the user in the interface 
    mediated by the gui module.
    
    **:param composicao:** <br>
    **:param temperatura:** <br>
    **:param pressao:** <br>
    **:return es:** density <br>
    **:rtype:** float

* **calculo_a(vsubs2, vx, vaij) -> float**
    
    Creating matrix aij and a.
    
    **:param vsubs2:** list with the elements used <br>
    **:rtype:** list

* **calculo_aij(vk_ij, vai, subs) -> list**
    
    Calculates the term 'aij' from the Peng Robison eq by multiplying the terms of the matrices aij and kij.
    
    **:param vk_ij:** kij matrix already adjusted for the components used <br>
    **:param go:** matrix 'ai' <br>
    **:return:** matrix aij <br>
    **:rtype:** list

* **calculo_bi_PREOS(vsubs2, x) -> list**

    Calculates the bi parameters of Peng Robinson's eq.

    **:param vsubs2:** list with the elements used <br>
    **:rtype:** list
  
 * **calculo_ki_PREOS(vsubs2, x) -> list**

    Calculates the ki parameters of Peng Robinson's eq.

    **:param vsubs2:** list with the elements used <br>
    **:rtype:** list

* **cont_massa_molar_mistura(vmassa, subs, x) -> list**
    
    Molar Mass Contribution of Each Fluid Molar Mass Contribution of Each Fluid.
    
    **:param vmassa:** list with molar mass of each component of the mixture <br>
    **:rtype:** list

* **conversao_atm(p_list) -> list**

  Converts ATM pressure to kPa.

  **:param p_list:** lista com as pressoes em atm <br>
  **:type p_list:** list <br>
  **:rtype:** list


* **converter_temperatura_kelvin(unidade, valor) -> float**
  
  Converts the given temperature in celsius or fahrenheit to kelvin.

  **:param unidade:** indicates the temperature unit <br>
  **:param valor:** indicates the temperature value in the referred unit <br>
  **:return valor:** temperature value in kelvin <br>
  **:rtype:** float

* **eq_cubica(b, c, d) -> list**
    
    Solves a cubic eq by returning a list of real roots.

    **:param b:** parameter b of cubic eq of type ax³ + bx² + cx + d = 0 <br>
    **:type b:**  float <br>
    **:param c:** parameter c of cubic eq of type ax³ + bx² + cx + d = 0 <br>
    **:type c:** float <br>
    **:param d:** parameter d of cubic eq of type ax³ + bx² + cx + d = 0 <br>
    **:type d:** float <br>
    **:return:** retorna as raizes reais <br>
    **:rtype:** list <br>

* **formatar_dados_arquivo(dados) -> list**

    Transforms strings read from the file into an array of numbers.

    **:rtype**: list

* **formatar_input_composicao(matrizComposicao) -> list**

    Format mix composition input so that it is in the order used by the program

    **:param matrizComposicao:**  <br>
    **:return composicaoFormatada:**  <br>
    **:rtype:** list

* **fracao_molar_substancias(velementos, vsubs, vfracao_molar) -> list**

    Create new molar fraction list from 'molar fraction and subs' so that it is in the same order as the 'elements' list, to facilitate the calculation of aij.

    **:param velementos:** list with all available elements <br>
    **:param vsubs:** list with chosen elements <br>
    **:param vfracao_molar:** molar fraction of chosen elements <br>
    **:return:** list with molar fraction in correct order for calculations <br>
    **:rtype:** list

* **input_composicao(composicao) -> list**
    Create a list with the compositions.

    **:param composicao:**  <br>
    **:rtype:** list <br>
    
* **input_fracao(composicao) -> list**
    
    Create a list of molar fractions.

    **:param composicao:** <br>
    **:rtype:** list

* **ler_arquivo(nomeArquivo, codigo) -> list**
    
    Read data from file.
    
    **:return data:** file data <br>
    **:rtype:** list 

* **lista_pressoes(p_inicial, p_final, passo) -> list**
    
    Creates a list with pressures according to the chosen step.

    **:param composicao:** <br>
    **:rtype:** list

* **massa_especifica_estavel(r_estavel, press, r, t, massa_molar_total) -> float**
    
    Calculates the stable density from the stable Z root.
    
    **:param r_stable:** root stable <br>
    **:return:** returns stable root mass <br>
    **:rtype:** float

* **massa_especifica_geral(b1, c1, d1, massa_molar_total, p, r, t) -> list**
  
    Calculate the density for all actual Z results.

    **:rtype:** list

* **massa_especifica_isoterma(p_inicial, p_final, passo, a, r, t, b, massa_molar_total) -> list**

    Calculates the density according to the defined isotherm.

    **:rtype:** list

* **matriz_kij(velementos, vsubs) -> list**

    Creates a matrix with the Kij that will be used in the calculation.

    **:param velementos:** list with all available elements <br>
    **:param vsubs:** list with the elements used <br>
    **:rtype:** list
    
* **obter_nome_padrao(codigo) -> str**
    
    Creates a default name for the file to be saved.
    
    **:return nomePadraoArquivo:** name of file <br>
    **:rtype:** str

* **plot_isoterma(listaPressoes, listaMassaEspIsoterma, t, codigo_idioma) -> None**

    Displays isotherm graph in a matplotlib window.

    **:rtype:** None

* **prop_criticas(subs2) -> list**
    
    Creates lists for the critical properties of each element of the mix in element order.
    
    **:rtype:** list

* **salvar_csv(m_esp, temperatura, composicao, nomeArquivo, codigo) -> None**
  
    Creates a csv file with the calculated specific masses.

    **:param m_esp:** list in table form with the specific masses <br>
    **:rtype:** None

* **salvar_txt(m_esp, temperatura, composicao, nomeArquivo, codigo) -> None**
  
    Creates a txt file with the calculated specific masses.

    **:param m_esp:** list in table form with the specific masses <br>
    **:rtype:** None

* **stable_root(Zlist, pressure, A, B) -> float**

    Defines the stable Z root from the fugacity calculation.

    **:param Zlist:** list of Z values <br>
    **:type Zlist:** list <br>
    **:param pressure:** pressure value <br>
    **:type pressure:** float <br>
    **:param A:** parameter A of the cubic equation of PR <br>
    **:type A:** float <br>
    **:param B:** parameter B of the cubic equation of PR <br>
    **:type B:** float <br>
    **:rtype:** float <br>

* **tabela_massa_especifica(pressoes, me) -> list**

    Creates a table with the specific masses of the defined isotherm.
    
    **:rtype:** list

* **to_tabela_composicao(composicao) -> list**
    
    Turns the composition dictionary into a table with the composition used in the calculation. <br>
    
    **:param composition:** list in table form with specific masses and pressure values
    **:return:** matrix with compositions <br>
    **:rtype:** list
    
* **verificar_soma_fracao_molar(matrizComposicao) -> bool**
    
    Check if the sum of molar fractions is different from 1.0.

    **:param matrizComposicao:** matrix that contains the name and value of each substance in the composition
    matrizComposicao[[SubstanceName, SubstanceValue],...] <br>
    **:return:** true, if sum is different from 1.0. false otherwise <br>
    **:rtype:** bool

<h2 id="author" align="justify">Development</h2>

* Developed by:
    * Mateus Pereira de Sousa 
    * Valesca Moura de Sousa
* Advisors:
    * Felipe Pereira de Moura
    * Fernanda Gonçalves de Oliveira Passos
    * Rogério Fernandes de Lacerda
* <a href="http://hidrouff.sites.uff.br/">HidroUFF Laboratory</a>
* Creation date: 08/18/2020
* Last revised: 09/14/2021
* Any suggestions or questions about the application, communicate one of the responsible: <a href="mailto:lab.hidrouff.tce@id.uff.br">lab.hidrouff.tce@id.uff.br</a>


<h2 id="quoting" align="justify">Quoting</h2>
If the HidroUFF Specific Mass Calculator contributed to any project or research that resulted in a publication, please cite it.

<div align="center"> 
  
  <a href="https://doi.org/10.5281/zenodo.5719756"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5719756.svg" alt="DOI"></a>
  
</div>
